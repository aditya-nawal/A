<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Based on the following documentation about an expl</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .content {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .metadata {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="content">Remote Exploitation of an Unaltered Passenger Vehicle - Dr. Charlie Miller () Chris Valasek () Page created by Joel Meyer Travel English Like Share Embed Fullscreen Slides Download HTML Download PDF Abuse ← CONTINUE READING → Page content transcription If your browser does not render page correctly, please read the page content below Remote Exploitation of an Unaltered Passenger Vehicle Dr. Charlie Miller (cmiller@openrce.org) Chris Valasek (cvalasek@gmail.com) August 10, 2015 1 Contents Introduction and background ....................................................................................................................... 5 Target – 2014 Jeep Cherokee........................................................................................................................ 7 Network Architecture ............................................................................................................................... 8 Cyber Physical Features .......................................................................................................................... 10 Adaptive Cruise Control (ACC) ............................................................................................................ 10 Forward Collision Warning Plus (FCW+) ............................................................................................. 10 Lane Departure Warning (LDW+)........................................................................................................ 11 Park Assist System (PAM) ................................................................................................................... 12 Remote Attack Surface ........................................................................................................................... 13 Passive Anti-Theft System (PATS) ....................................................................................................... 13 Tire Pressure Monitoring System (TPMS) ........................................................................................... 14 Remote Keyless Entry/Start (RKE) ....................................................................................................... 15 Bluetooth ............................................................................................................................................ 16 Radio Data System .............................................................................................................................. 17 Wi-Fi .................................................................................................................................................... 18 Telematics/Internet/Apps ................................................................................................................... 18 Uconnect System ........................................................................................................................................ 20 QNX Environment ................................................................................................................................... 20 File System and Services ......................................................................................................................... 20 IFS ........................................................................................................................................................ 21 ETFS ..................................................................................................................................................... 23 MMC.................................................................................................................................................... 23 PPS....................................................................................................................................................... 23 Wi-Fi ........................................................................................................................................................ 25 Encryption ........................................................................................................................................... 25 Open ports .......................................................................................................................................... 27 D-Bus Services ......................................................................................................................................... 29 Overview ............................................................................................................................................. 29 Cellular .................................................................................................................................................... 32 CAN Connectivity .................................................................................................................................... 33 Jailbreaking Uconnect ................................................................................................................................. 34 Any Version ............................................................................................................................................. 34 2 Version 14_05_03 ................................................................................................................................... 36 Update Mode .......................................................................................................................................... 37 Normal Mode .......................................................................................................................................... 37 Exploiting the D-Bus Service ....................................................................................................................... 38 Gaining Code Execution .......................................................................................................................... 38 Uconnect attack payloads ........................................................................................................................... 40 GPS .......................................................................................................................................................... 40 HVAC ....................................................................................................................................................... 41 Radio Volume .......................................................................................................................................... 41 Bass ......................................................................................................................................................... 41 Radio Station (FM) .................................................................................................................................. 41 Display ..................................................................................................................................................... 42 Change display to Picture.................................................................................................................... 42 Knobs....................................................................................................................................................... 43 Cellular Exploitation .................................................................................................................................... 43 Network Settings..................................................................................................................................... 43 Femtocell................................................................................................................................................. 44 Cellular Access......................................................................................................................................... 45 Scanning for vulnerable vehicles ................................................................................................................ 46 Scanning results ...................................................................................................................................... 47 Estimating the number of vulnerable vehicles ....................................................................................... 47 Vehicle Worm ......................................................................................................................................... 48 V850 ............................................................................................................................................................ 48 Modes ..................................................................................................................................................... 48 Updating the V850 .................................................................................................................................. 48 Reverse Engineering IOC ......................................................................................................................... 50 Flashing the v850 without USB ............................................................................................................... 64 SPI Communications .................................................................................................................................. 67 SPI message protocol .............................................................................................................................. 67 Getting V850 version information .......................................................................................................... 68 V850 compile date .................................................................................................................................. 68 V850 vulnerabilities in firmware ............................................................................................................. 69 Sending CAN messages through the V850 chip ...................................................................................... 70 3 The entire exploit chain .............................................................................................................................. 71 Identify target ......................................................................................................................................... 71 Exploit the OMAP chip of the head unit ................................................................................................. 71 Control the Uconnect System ................................................................................................................. 71 Flash the v850 with modified firmware .................................................................................................. 71 Perform cyber physical actions ............................................................................................................... 71 Cyber Physical Internals .............................................................................................................................. 72 Mechanics Tools...................................................................................................................................... 72 Overview ............................................................................................................................................. 73 SecurityAccess..................................................................................................................................... 75 PAM ECU Reversing ................................................................................................................................ 78 Cyber Physical CAN messages ..................................................................................................................... 83 Normal CAN messages ............................................................................................................................ 83 Turn signal ........................................................................................................................................... 84 Locks.................................................................................................................................................... 84 RPMS ................................................................................................................................................... 84 Diagnostic CAN messages ....................................................................................................................... 84 Kill engine ............................................................................................................................................ 85 No brakes ............................................................................................................................................ 85 Steering ............................................................................................................................................... 85 Disclosure .................................................................................................................................................... 86 Patching and mitigations ............................................................................................................................ 87 Conclusion ................................................................................................................................................... 87 Acknowlegements....................................................................................................................................... 89 References .................................................................................................................................................. 90 4 Introduction and background Car security research is interesting for a general audience because most people have cars and understand the inherent dangers of an attacker gaining control of their vehicle. Automotive security research, for the most part, began in 2010 when researchers from the University of Washington and the University of California San Diego [1] showed that if they could inject messages into the CAN bus of a vehicle (believed to be a 2009 Chevy Malibu) they could make physical changes to the car, such as controlling the display on the speedometer, killing the engine, as well as affecting braking. This research was very interesting but received widespread criticism because people claimed there was not a way for an attacker to inject these types of messages without close physical access to the vehicle, and with that type of access, they could just cut a cable or perform some other physical attack. The next year, these same research groups showed that they could remotely perform the same attacks from their 2010 paper [2]. They showed three different ways of getting code execution on the vehicle including the mp3 parser of the radio, the Bluetooth stack, and through the telematics unit. Once they had code running, they could then inject the CAN messages affecting the physical systems of the vehicle. This remote attack research was ground breaking because it showed that vehicles were vulnerable to attacks from across the country, not just locally. The one thing both research papers didn’t do was to document in detail how these attacks worked or even what kind of car was used. Shortly thereafter, in 2012, the authors of this paper received a grant from DARPA to produce a library of tools that would aid in continuing automotive research and reduce the barrier of entry to new researchers into the field. We released these tools [3] as well as demonstrated physical attacks against two late model vehicles, a 2010 Ford Escape and a 2010 Toyota Prius. The same tools have been used by many researchers and are even used for testing by the National Highway Traffic Safety Administration [34]. Our 2012 research assumed that a remote compromise was possible, due to the material released by the academic researchers in previous years. Therefore, we assumed that we could inject CAN messages onto the bus in a reliable fashion. In addition to releasing tools, we also released the exact messages used for the attacks to encourage other researchers to get involved in vehicle research. Besides releasing the tools and documenting the attacks, another major contribution of ours was demonstrating how steering could be controlled via CAN messages. This was due to vehicles evolving since the previous research to now include features like automatic parallel parking and lane keep assist which necessitated the steering ECU accept commands over the CAN bus. This demonstrates the point that as new technology is added to vehicles, new attacks become possible. The response from the automotive industry, again, was to point out that these attacks were only possible because we had physical access to the vehicles in order to inject the messages onto the bus. For example, Toyota released a statement that said in part “Our focus, and that of the entire auto industry, is to prevent hacking from a remote wireless device outside of the vehicle. We believe our systems are robust and secure.” [4] In 2013 we received a second DARPA grant to try to produce a platform that would help researchers conduct automotive security research without having to purchase a vehicle. Again, the focus was on getting more eyes on the problem by reducing the cost and effort of doing automotive research, especially for those researchers coming from a more traditional computer security background. [5] 5 In 2014, in an effort to try to generalize beyond the three cars that at that time had been examined at a very granular level (2009 Chevy Malibu, 2010 Ford Escape, 2010 Toyota Prius), we gathered data on the architecture of a large number of vehicles. At a high level we tried to determine which vehicles would present the most obstacles to an attacker, starting with evaluating the attack surface, to getting CAN messages to safety critical ECUs, and finally getting the ECUs to take some kind of physical action [6]. In the end we found that the 2014 Jeep Cherokee, along with two other vehicles, seemed to have a combination of a large attack surface, simple architecture, and many advanced physical features that would make it an ideal candidate to try to continue our research. A 2014 Jeep Cherokee was procured for the research described in this paper as we wanted to show, much like the academic researchers, that the attacks we had previously outlined against the Ford and Toyota were possible remotely as well. Since the automotive manufacturers made this such a point of pride after we released our original research, we wanted to demonstrate that remote attacks against unaltered vehicles is still possible and that we need to encourage everyone to take this threat seriously. This paper outlines the research into performing a remote attack against an unaltered 2014 Jeep Cherokee and similar vehicles that results in physical control of some aspects of the vehicle. Hopefully this additional remote attack research can pave the road for more secure connected cars in our future by providing this detailed information to security researchers, automotive manufacturers, automotive suppliers, and consumers. 6 Target – 2014 Jeep Cherokee The 2014 Jeep Cherokee was chosen because we felt like it would provide us the best opportunity to successfully demonstrate that a remote compromise of a vehicle could result in sending messages that could invade a driver’s privacy and perform physical actions on the attacker’s behalf. As pointed out in our previous research [6], this vehicle seemed to present fewer potential obstacles for an attacker. This is not to say that other manufacturer’s vehicles are not hackable, or even that they are more secure, only to show that with some research we felt this was our best target. Even more importantly, the Jeep fell within our budgetary constraints when adding all the technological features desired by the authors of this paper. http://www.blogcdn.com/www.autoblog.com/media/2013/02/2014-jeep-cherokee-1.jpg 7 Network Architecture The architecture of the 2014 Jeep Cherokee was very intriguing to us due to the fact that the head unit (Radio) is connected to both CAN buses that are implemented in the vehicle. Figure: 2014 Jeep Cherokee architecture diagram We speculated that if the Radio could be compromised, then we would have access to ECUs on both the CAN-IHS and CAN-C networks, meaning that messages could be sent to all ECUs that control physical attributes of the vehicle. You’ll see later in this paper that our remote compromise of the head unit does not directly lead to access to the CAN buses and further exploitation stages were necessary. With that being said, there are no CAN bus architectural restrictions, such as the steering being on a physically separate bus. If we can send messages from the head unit, we should be able to send them to every ECU on the CAN bus. 8 CAN C Bus 1. ABS MODULE - ANTI-LOCK BRAKES 2. AHLM MODULE - HEADLAMP LEVELING 3. ACC MODULE - ADAPTIVE CRUISE CONTROL 4. BCM MODULE - BODY CONTROL 5. CCB CONNECTOR - STAR CAN C BODY 6. CCIP CONNECTOR - STAR CAN C IP 7. DLC DATA LINK CONNECTOR 8. DTCM MODULE - DRIVETRAIN CONTROL 9. EPB MODULE - ELECTRONIC PARKING BRAKE 10. EPS MODULE - ELECTRIC POWER STEERING 11. ESM MODULE - ELECTRONIC SHIFT 12. FFCM CAMERA - FORWARD FACING 13. IPC CLUSTER 14. OCM MODULE - OCCUPANT CLASSIFICATION 15. ORC MODULE - OCCUPANT RESTRAINT CONTROLLER 16. PAM MODULE - PARK ASSIST 17. PCM MODULE - POWERTRAIN CONTROL (2.4L) 18. RADIO MODULE - RADIO 19. RFH MODULE - RADIO FREQUENCY HUB 20. SCM MODULE - STEERING CONTROL 21. SCLM MODULE - STEERING COLUMN LOCK 22. TCM MODULE - TRANSMISSION CONTROL CAN IHS Bus 1. AMP AMPLIFIER - RADIO 2. BCM MODULE - BODY CONTROL 3. CCB CONNECTOR - STAR CAN IHS BODY 4. CCIP CONNECTOR - STAR CAN IHS IP 5. DDM MODULE - DOOR DRIVER 6. DLC DATA LINK CONNECTOR 7. EDM MODULE - EXTERNAL DISC 8. HSM MODULE - HEATED SEATS 9. HVAC MODULE - A/C HEATER 10. ICS MODULE - INTEGRATED CENTER STACK SWITCH 11. IPC MODULE - CLUSTER 12. LBSS SENSOR - BLIND SPOT LEFT REAR 13. MSM MODULE - MEMORY SEAT DRIVER 14. PDM MODULE - DOOR PASSENGER 15. PLGM MODULE - POWER LIFTGATE 16. RADIO MODULE - RADIO (Not a Bridge) 17. RBSS SENSOR - BLIND SPOT RIGHT REAR 9 Cyber Physical Features This section describes the systems used in the 2014 Jeep Cherokee for assisted driving. These technologies are especially interesting to us as similar systems have been previously leveraged in attacks to gain access to physical attributes of the automobile [3]. While we believe these technological advances increase the safety of the driver and its surroundings, they present an opportunity for an attacker to use them as a means to control the vehicle. Adaptive Cruise Control (ACC) The 2014 Jeep we used in our testing had Adaptive Cruise Control (ACC), which is a technology that assists the driver in keeping the proper distance between themselves and cars ahead of them. Essentially, it makes sure that if cruise control is enabled and a vehicle slows down in front of you, the Jeep will apply the brakes with the appropriate pressure to avoid a collision and resume the cruise control speed after the obstacle moves out of the way or is at a safe distance. The ACC can slow the vehicle to a complete stop if the vehicle in front of it comes to a stop. Forward Collision Warning Plus (FCW+) Much like ACC, Forward Collision Warning Plus (FCW+) prevents the Jeep from colliding with objects in front of it. Unlike ACC, FCW+ is always enabled unless explicitly turned off, giving the driving the added benefit of assisted braking in the event of an anticipated collision. For example, if the driver was checking Twitter on their phone instead of watching the road and the vehicle in front of her came to an abrupt stop, FCW+ would emit an audible warning and apply the brakes on behalf of the driver. Figure: FCW+ 10 Lane Departure Warning (LDW+) Lane Departure Warning Plus (LDW+) is another feature used to ensure driver safety when driving on the highway. LDW+, when enabled, examines the lines on the road (i.e. paint) in attempt to figure out if the Jeep is making unintended movements into other lanes, in hopes of preventing a collision or worse. If it detects the Jeep is leaving the current lane, it will adjust the steering wheel to keep the vehicle in the current lane. Figure: LDW+ 11 Park Assist System (PAM) One of the newest features to enter the non-luxury space in recent times is Parking Assist Systems (PAM). The PAM in the Jeep permits the driver to effortlessly park the car without much driver interaction in various scenarios, such as parallel parking, backing into a space, etc. The authors of this paper considered this to be the easiest entry point to control steering in modern vehicles and have proven to use this technology to steer an automobile at high speed with CAN messages alone [3]. As you’ll see later in this document, the PAM technology and module played key roles in several aspects of our research. Figure: Display while using PAM system 12 Remote Attack Surface The following table is a list of the potential entry points for an attacker. While many people only think of these items in terms of technology, someone with an attacker’s mindset considers every piece of technology that interacts with the outside world a potential entry point. Entry Point ECU Bus RKE RFHM CAN C TPMS RFHM CAN C Bluetooth Radio CAN C, CAN IHS FM/AM/XM Radio CAN C, CAN IHS Cellular Radio CAN C, CAN IHS Internet / Apps Radio CAN C, CAN IHS Passive Anti-Theft System (PATS) For many modern cars, there is a small chip in the ignition key that communicates with sensors in the vehicle. For the Jeep, this sensor is wired directly into the Radio Frequency Hub Module (RFHM). When the ignition button is pressed, the on-board computer sends out an RF signal that is picked up by the transponder in the key. The transponder then returns a unique RF signal to the vehicle's computer, giving it confirmation to start and continue to run. This all happens in less than a second. If the on- board computer does not receive the correct identification code, certain components such as the fuel pump and, on some, the starter will remain disabled. As far as remote attacks are concerned, this attack surface is very small. The only data transferred (and processed by the software on the IC) is the identification code and the underlying RF signal. It is hard to imagine an exploitable vulnerability in this code, and even if there was one, you would have to be very close to the sensor, as it is intentionally designed to only pick up nearby signals. Figure: Display with no key 13 Tire Pressure Monitoring System (TPMS) Each tire has a pressure sensor that is constantly measuring the tire pressure and transmitting real time data to an ECU. In the Jeep, the receiving sensor is wired into the RFHM. This radio signal is proprietary, but some research has been done in understanding the TPMS system for some vehicles and investigating their underlying security. [7] It is certainly possible to perform some actions against the TPMS, such as causing the vehicle to think it is having a tire problem, or issues with the TPMS system. Additionally, researchers have shown [7] that it is possible to actually crash and remotely brick the associated ECU in some cases. Regarding code execution possibilities, it seems the attack surface is rather small, but remote bricking indicates that data is being processed in an unsafe manner and so this might be possible. Figure: 2014 Jeep Cherokee TPMS display 14 Remote Keyless Entry/Start (RKE) Key fobs, or remote keyless entry (RKE), contain a short-range radio transmitter that communicates with an ECU in the vehicle. The radio transmitter sends data containing identifying information from which the ECU can determine if the key is valid and subsequently lock, unlock, and start the vehicle. In the Jeep, again the RFHM receives this information. With regards to remote code execution, the attack surface is quite small. The RFHM must have some firmware to handle RF signal processing, encryption/decryption code, logic to identify data from the key fob, and to be programmed for additional/replacement key fobs. While this is a possible avenue of attack, finding and exploiting a vulnerability for remote code execution in the RKE seems unlikely and limited. Figure: 2014 Jeep key fob 15 Bluetooth Most vehicles have the ability to sync a device over Bluetooth. This represents a remote signal of some complexity processed by an ECU. In the Jeep, Bluetooth is received and processed by the Radio (a.k.a. the head unit). This allows the car to access the address book of the phone, make phone calls, stream music, send SMS messages from the phone, and other functionality. Unlike the other signals up to now, the Bluetooth stack is quite large and represents a significant attack surface that has had vulnerabilities in the past [8]. There are generally two attack scenarios involving a Bluetooth stack. The first attack involves an un-paired device. This attack is the most dangerous as any attacker can reach this code. The second method of exploitation occurs after pairing takes place, which is less of a threat as some user interaction is involved. Previously, researchers have shown remote compromise of a vehicle through the Bluetooth interface [2]. Researchers from Codenomicon have identified many crashes in common Bluetooth receivers found in automobiles [9]. Figure: 2014 Jeep Cherokee Bluetooth dashboard 16 Radio Data System The radio not only receives audio signals, but other data as well. In the Jeep, the Radio has many such remote inputs, such as GPS, AM/FM Radio, and Satellite radio. For the most part, these signals are simply converted to audio output and don’t represent significant parsing of data, which means they are likely to not contain exploitable vulnerabilities. One possible exception is likely to be the Radio Data System data that is used to send data along with FM analogue signals (or the equivalent in satellite radio). This is typically seen by users when radios will say the names of stations, the title of the song playing, etc. Here, the data must be parsed and displayed, making room for a security vulnerability. Figure: 2014 Jeep Cherokee radio data dashboard 17 Wi-Fi Some automobiles with cellular based Internet connections actually share this Internet connections with passengers by acting like a Wi-Fi hotspot. In the Jeep, this is a feature that must be purchased per use, for example for a single day or up to a month. One observation we made was that the Wi-Fi system could be assessed by individuals without advanced knowledge of automotive systems. Wi-Fi security assessment methodologies have been around for years and access point hacking has been frequently documented in recent times [10]. Figure: 2014 Jeep Cherokee Wi-Fi dashboard Telematics/Internet/Apps Many modern automobiles contain a cellular radio, generically referred to as a telematics system, which is used to connect to the vehicle to a cellular network, for example GM’s OnStar. The cellular technology can also be used to retrieve data, such as traffic or weather information. This is the holy grail of automotive attacks since the range is quite broad (i.e. as long as the car can have cellular communications). Even if a telematics unit does not reside directly on the CAN bus, it does have the ability to remotely transfer data/voice, via the microphone, to another location. Researchers previously remotely exploited a telematics unit of an automobile without user interaction [2]. On the Jeep, all of these features are controlled by the Radio, which resides on both the CAN-IHS bus and the CAN-C bus. 18 The telematics, Internet, radio, and Apps are all bundled into the Harman Uconnect system that comes with the 2014 Jeep Cherokee. The Uconnect system is described in greater detail below, but we wanted to point out that all the functionality associated with ‘infotainment’ is physically located in one unit. http://www.thetruthaboutcars.com/wp-content/uploads/2014/02/2014-Jeep-Cherokee-Limited-Interior-uConnect-8.4.jpg 19 Uconnect System The 2014 Jeep Cherokee uses the Uconnect 8.4AN/RA4 radio manufactured by Harman Kardon as the sole source for infotainment, Wi-Fi connectivity, navigation, apps, and cellular communications [11]. A majority of the functionality is physically located on a Texas Instruments OMAP-DM3730 system on a chip [12], which appears to be common within automotive systems. These Harman Uconnect systems are available on a number of different vehicles from Fiat Chrysler Automotive including vehicles from Chrysler, Dodge, Jeep, and Ram. It is possible Harman Uconnect systems are available in other automobiles as well. The Uconnect head unit also contains a microcontroller and software that allows it to communicate with other electronic modules in the vehicle over the Controller Area Network - Interior High Speed (CAN- IHS) data bus. In vehicles equipped with Uconnect Access, the system also uses electronic message communication with other electronic modules in the vehicle over the CAN-C data bus. The Harman Uconnect system is not limited to the Jeep Cherokee, and is quite common in the Chrysler- Fiat line of automobiles and even looks to make an appearance in the Ferrari California! [13]. This means that while the cyber physical aspects of this paper are limited to a 2014 Jeep Cherokee, the Uconnect vulnerabilities and information is relevant to any vehicle that includes the system. Therefore the amount of vulnerable vehicles on the road increases dramatically. QNX Environment The Uconnect system in the 2014 Jeep Cherokee runs the QNX operating system on a 32-bit ARM processor, which appears to be a common setup for automotive infotainment systems. Much of the testing and examination can be done on a QNX virtual machine [17] if the physical Uconnect system is not available, although it obviously helps to have a working unit for applied research. # pidin info CPU:ARM Release:6.5.0 FreeMem:91Mb/512Mb BootTime:Jul 30 21:45:38 2014 Processes: 107, Threads: 739 Processor1: 1094697090 Cortex A8 800MHz FPU In addition to having a virtual QNX system to play with, the ISO package used for updates and reinstallation of the operating system can be downloaded quite easily from the Internet [18]. By having the ISO file and investigating the directory structure and file system, various pieces of the research can be completed without a vehicle, Uconnect system, or QNX virtual machine, such as reverse engineering select binaries. File System and Services The NAND flash used in our Uconnect unit contained several different file systems that served various purposes. The list below are the file systems of interest and portions that required additional research will be discussed later in this paper. For more information regarding the different portions of the QNX image please see their documentation [19].  IPL: The Initial Program Loader (IPL) portion contained the bootloader used for loading up the Uconnect system. Although very interesting, we did not examine the bootloader at length as other aspects of the head unit were more relevant for our goal of physical control of the vehicle. 20  IFS: The IFS contains the QNX file system image and is loaded into RAM at boot time. This file system contains all the binaries and configuration files one would assume would be associated with an operating system. The IFS portion is read-only. Therefore, while there are many binaries that are tempting to overwrite/replace, the attacker’s ability is limited. That being said, the IFS is modified during the update process, which will be discussed later in this document.  ETFS: The Embedded Transaction File system (ETFS) is a read-write file system that can be modified. The ETFS is made for use with embedded solid-state memory devices. ETFS implements a high-reliability file system for use with embedded solid-state memory devices, particularly NAND flash memory. The file system supports a fully hierarchical directory structure with POSIX semantics.  MMC: The Multimedia Card (MMC) portion is mounted at /fs/mmc0/ and is used for system data. This is the only large area of the Uconnect system that can be made writable, which we will subsequently use as a place to store files during exploitation. IFS As stated above, the IFS is used to house the system binaries and configuration files necessary to run the QNX operation system on the Uconnect head unit. The file system can be examined by looking at files in the ISO obtained from Chrysler to see what files would be affected during an update process. For example, examining ‘manifest’ in the main directory of the unpackaged ISO reveals that the IFS is located within a file named ‘ifs-cmc.bin’. ifs = { name = "ifs installer.", installer = "ifs", data = "ifs-cmc.bin", }, If we want to look at the IFS without having a Uconnect system, the ‘swdl.bin’ needs to be mounted in a QNX virtual machine since it is a non-standard IFS image. It contains all the system executables required for the update process. The ‘swdl.bin’ file can be found in the ‘swdl/usr/share’ directory. For example, to dump the IFS on QNX (or a QNX virtual machine in our case), you can run something similar to the following command: memifs2 -q -d /fs/usb0/usr/share/swdl.bin / The result is being able to examine a root directory (“/”) that is mounted read-only. This file system can be completely iterated by issuing the ‘dumpifs’ command. The output below is what was dumped from our IFS contained in the update ISO. Offset Size Name 0 8 *.boot 8 100 Startup-header flags1=0x9 flags2=0 paddr_bias=0 108 22008 startup.* 22110 5c Image-header mountpoint=/ 2216c cdc Image-directory ---- ---- Root-dirent 23000 8a000 proc/boot/procnto-instr ad000 325c proc/boot/.script 21 ---- 3 bin/sh -> ksh ---- 9 dev/console -> /dev/ser3 ---- a tmp -> /dev/shmem ---- 10 usr/var -> /fs/etfs/usr/var ---- 16 HBpersistence -> /fs/etfs/usr/var/trace ---- a var/run -> /dev/shmem ---- a var/lock -> /dev/shmem ---- a var/log/ppp -> /dev/shmem ---- 15 opt/sys/bin/pppd -> /fs/mmc0/app/bin/pppd ---- 15 opt/sys/bin/chat -> /fs/mmc0/app/bin/chat ---- 18 bin/netstat -> /fs/mmc0/app/bin/netstat ---- 16 etc/resolv.conf -> /dev/shmem/resolv.conf ---- 16 etc/ppp/resolv.conf -> /dev/shmem/resolv.conf ---- 18 etc/tuner -> /fs/mmc0/app/share/tuner ---- 8 var/override -> /fs/etfs ---- c usr/local -> /fs/mmc0/app ---- b usr/share/eq -> /fs/mmc0/eq b1000 12af etc/system/config/fram.conf b3000 38c etc/system/config/nand_partition.txt b4000 56b etc/system/config/gpio.conf b5000 247b bin/cat b8000 1fed bin/io ba000 2545 bin/nice bd000 216a bin/echo c0000 38e0f bin/ksh f9000 41bb bin/slogger fe000 60a1 bin/waitfor 105000 531b bin/pipe 10b000 5e02 bin/dev-gpio 120000 1270b bin/dev-ipc 140000 1f675 bin/io-usb 160000 29eb bin/resource_seed 163000 3888 bin/spi-master 167000 48a0 bin/dev-memory 16c000 9eab bin/dev-mmap 176000 602c bin/i2c-omap35xx 17d000 da08 bin/devb-mmcsd-omap3730teb 18b000 dd3 bin/dev-ipc.sh 18c000 2198 bin/mmc.sh 190000 1208f bin/devc-seromap 1a3000 323d bin/rm 1a7000 ffa2 bin/devc-pty 1b7000 4eb bin/startSplashApp 1b8000 692 bin/startBackLightApp 1b9000 1019 bin/mmc_chk 1bb000 42fe usr/bin/adjustImageState 1c0000 12c81 usr/bin/memifs2 1d3000 284 usr/bin/loadsecondaryifs.sh 1e0000 77000 lib/libc.so.3 ---- 9 lib/libc.so -> libc.so.3 260000 b0e4 lib/dll/devu-omap3530-mg.so 26c000 9d17 lib/dll/devu-ehci-omap3.so 276000 4705 lib/dll/spi-omap3530.so 280000 14700 lib/dll/fs-qnx6.so 295000 36e6 lib/dll/cam-disk.so 2a0000 2b7ba lib/dll/io-blk.so 2d0000 5594f lib/dll/charset.so 22 330000 1243c lib/dll/libcam.so.2 ---- b lib/dll/libcam.so -> libcam.so.2 350000 3886 lib/dll/fram-i2c.so Checksums: image=0x702592f4 startup=0xc11b20c0 While the ‘dumpifs’ command does not appear to have everything one would associate with a complete operating system, such as ‘/etc/shadow’, running grep on the binary shows that such files are most likely present. For example, if you search for ‘root’ there are several instances of the string, the most interesting two being: root:x:0:a root:ug6HiWQAm947Y:::9b A more thorough examination of the IFS can be done on a working head unit that has been jailbroken for remote access. We’ll discuss jailbreaking the head unit later on in this document. ETFS ETFS implements a high-reliability file system for use with embedded solid-state memory devices, particularly NAND flash memory [20]. Obviously, there is no ETFS present on the ISO but it can be examined on a live Uconnect system. From our perspective there was not much interesting data on this file system, so we didn’t push much further. Example: /fs/etfs/usr/var/sdars/channelart/I00549T00.png MMC The MMC file system contained some of the most interesting items when investigating the ISO and Uconnect system. It was especially interesting since it can be mounted as read-write, meaning that if there was something of interest, say a boot-up script or network service, we could enable them or alter their contents. For example, we found items such as ‘sshd’, ‘boot.sh’, and ‘runafterupdate.sh’. The install script, ‘mmc.lua’, copies ‘/usr/share/MMC_IFS_EXTENSION’ from the ISO to ‘/fs/mmc0/app’. PPS There are many interesting services running on the QNX system, but explaining them all is beyond the scope of this document. One important service is the Persistent Publish/ (PPS) service. It has several files of interest to us in its respective directories. Most notably are the files listed below: /pps/can/vehctl /pps/can/tester /pps/can/can_c /pps/can/send /pps/can/comfortctl 23 These files are essentially places to write data so that other processes can use them as input. Think of them as UNIX pipes with some data handling capabilities to aid in the parsing of data structures. There is a well-defined API to interact with PPS files. Consider the following data stored in a PPS file: @gps city::Ottawa speed:n:65.412 position:json:{"latitude":45.6512,"longitude":-75.9041} To extract this data, you might use code seen below: const char *city; double lat, lon, speed; pps_decoder_t decoder; pps_decoder_initialize(&decoder, NULL); pps_decoder_parse_pps_str(&decoder, buffer); pps_decoder_push(&decoder, NULL); pps_decoder_get_double(&decoder, "speed", &speed); pps_decoder_get_string(&decoder, "city", &city); pps_decoder_push(&decoder, "position"); pps_decoder_get_double(&decoder, "latitude", &lat); pps_decoder_get_double(&decoder, "longitude", &lon); pps_decoder_pop(&decoder); pps_decoder_pop(&decoder); if ( pps_decoder_status(&decoder, false) == PPS_DECODER_OK ) { . . . } pps_decoder_cleanup(&decoder); The follow is a real-world example from a live Uconnect system: # cat send [n]@send DR_MM_Lat::1528099482 DR_MM_Long::1073751823 GPS_Lat::1528099482 GPS_Long::1073751823 HU_CMP::0 NAVPrsnt::1 RADIO_W_GYRO::1 Despite there being PPS files in a subdirectory called ‘can_c’, writing to these files did not appear to create CAN messages that we could witness with our sniffer. In other words, these PPS files just provide insight into how processes communicate without any direct communication access to the CAN bus. We originally hoped we’d be able to use these PPS files to send arbitrary CAN messages, but this proved to be non-viable for long enough that we moved our efforts elsewhere. That’s not to say it is impossible to use these files along with the PPS subsystem to send arbitrary CAN messages, we just thought we could find a better methods for our desired results. 24 Wi-Fi The 2014 Jeep Cherokee has the option for in-car Wi-Fi, which is a hotspot that is only accessible after paying for the service on the web or through the Uconnect system. Later in the document, we will discuss a vulnerability in the Wi-Fi hotspot but remember that it would only be exploitable if the owner had enabled and paid for the functionality. Encryption The default Wi-Fi encryption method is WPA2 with a randomly generated password containing at least 8 alphanumeric characters. Due to the current strength of WPA2 and the number of possible passwords, this is a pretty secure setup, which begs the question, how does an attacker gain access to this network? One of the easier, but less likely possibilities, is that the user has chosen WEP or no encryption at all, both of which are available options. In either case, the attacker would have very little problem gaining access to the wireless access point by either cracking the WEP password [20] or just joining the access point. Another attack scenario exists if the attacker has already compromised a device connecting to the Wi-Fi hotspot in the car, such as a laptop computer or mobile phone. The fact the owner is paying for this service means that they probably have a phone or other device that they are regularly connecting to the wireless network. In this case, if the attacker can gain access to one of these devices, they will already be connected to the car’s wireless network. Unfortunately, we feel that this scenario has too many prerequisites to be l33t. However, as we’ll see, even in the case where the user has the default WPA2 setting, it is still possible for the attacker to access the network, and it may be quite easy. Disassembling the ‘WifiSvc’ binary from the OMAP chip (which can be acquired by dumping the binary from a live QNX instance), one can identify the algorithm used to construct the random password. This algorithm occurs in a function identified as WiFi.E:generateRandomAsciiKey(). As seen by disassembling, the algorithm consists of the following: int convert_byte_to_ascii_letter(signed int c_val) { char v3; // r4@2 if ( c_val > 9 ) { if ( c_val > 35 ) v3 = c_val + 61; else v3 = c_val + 55; } else { v3 = c_val + 48; } return v3; } char *get_password(){ int c_max = 12; int c_min = 8; 25 unsigned int t = time(NULL); srand (t); unsigned int len = (rand() % (c_max - c_min + 1)) + c_min; char *password = malloc(len); int v9 = 0; do{ unsigned int v10 = rand(); int v11 = convert_byte_to_ascii_letter(v10 % 62); password[v9] = v11; v9++; } while (len > v9); return password; It appears that the random password is purely a function of the epoch time (in seconds). It is hard to investigate exactly when this password is generated, but evidence below indicates that the time starts when the head unit first boots up. Therefore it may be possible to generate a password list which can be used to try to brute force a WPA2 encrypted connection to the wireless access point. Based on the year of the car, an attacker could attempt to guess when it would have first been turned on and try the appropriate set of password attempts. Just for some reference, if we could guess what month a vehicle was first started, we’d have to only try around 15 million passwords. You could probably cut this in half if you consider cars probably aren’t likely to be started in the middle of the night. We’re not experts on the subject, but one source [22] indicates you can try 133,000 tries per second using offline cracking techniques. This means it would take you around 2 minutes per month. You could try an entire year in less than half an hour. In many scenarios, this is probably realistic although the estimate from [22] is probably overly optimistic. But, due to a complex timing vulnerability, there appears to be another easier way to crack the password, although please note that we have only tried this against our head unit and so can’t speak to how general this attack happens to be. When the head unit starts up the very first time, it doesn’t know what time it is. It has yet to get any signals from GPS or cellular connections. The file ‘clock.lua’ is responsible for setting the system time. In the function ‘start()’, the following code is found: local rtcTime = getV850RealtimeClock() local rtcValid = false if rtcTime == nil or rtcTime.year == 65535 or rtcTime.month == 255 or rtcTime.day == 255 or rtcTime.hour == 255 or rtcTime.mi n == 255 or rtcTime.sec == 255 then dbg.print("Clock: start -- V850 time not received or is set to factory defaults") ... if rtcValid == false then dbg.print("Clock: start -- Unable to create the UTC time from V850") setProperty("timeFormat24", false) setProperty("enableClock", true) setProperty("gpsTime", true) setProperty("manualUtcOffset", 0) 26 defTime = {} defTime.year = 2013 defTime.month = 1 defTime.day = 1 defTime.hour = 0 defTime.min = 0 defTime.sec = 0 defTime.isdst = false setSystemUTCTime(os.time(defTime)) timeFormatOverride = false enableClockOverride = false end This seems to indicate that when the head unit cannot get the time, it sets the time to 00:00:00 Jan 1, 2013 GMT. The question is whether the correct time has been set yet when the ‘WifiSvc’ is generating the WPA2 password the first time it is started. From our single data point, the answer is no. If you take the WPA2 password that came on our Jeep, “TtYMxfPhZxkp” and brute force all the possible times to see which one would have generated that password, you arrive at the result that the password that came on our Jeep was generated at Epioch time 0x50e22720. This corresponds to Jan 01 2013 00:00:32 GMT. This indicates that, indeed, our head unit took 32 seconds from the time that ‘clock.lua’ set the time until ‘WifiSvc’ generated the password and that it did not find the correct time in those 32 seconds. Therefore, in this case, in reality, there are only a few dozen of possible passwords to try, and in all likelihood, only a handful of realistic possibilities. In other words, the password can be brute forced almost instantaneously. Open ports One of the more obvious methods of assessing the Wi-Fi hotspot was to port scan the default gateway and examine if there were any ports open. To our surprise, not only were there ports open, but there were several open. Below is a list of listening ports, according to netstat # netstat -n | grep LISTEN tcp 0 0 *.6010 *.* LISTEN tcp 0 0 *.2011 *.* LISTEN tcp 0 0 *.6020 *.* LISTEN tcp 0 0 *.2021 *.* LISTEN tcp 0 0 127.0.0.1.3128 *.* LISTEN tcp 0 0 *.51500 *.* LISTEN tcp 0 0 *.65200 *.* LISTEN tcp 0 0 *.4400 *.* LISTEN tcp 0 0 *.6667 *.* LISTEN Below are short descriptions of the services discovered via the port scan:  2011: NATP  2021: MontiorService. This service delivers debug/trace information from runtime system into file or over TCP/IP; offers additionally the possibility to send GCF message over TCP/IP to the SCP system  3128: 3proxy. This is a proxy service.  4400: HmiGateway 27  6010: Wicome  6020: SASService. This service realizes the server part of client-server based Speech API architecture  6667: D-BUS session bus  51500: 3proxy admin web server  65200: dev-mv2trace With all of these services, many of which are proprietary, there is a good chance a vulnerability would be present that could allow remote exploitation. After a bit of research, the most interesting open port appeared to be 6667, which is usually reserved for IRC. Obviously, this Wi-Fi hotspot couldn’t have an IRC server running, right? After connecting to 6667 with a telnet client and hitting return a few times, we realized this wasn’t an IRC server, but D-Bus [23] over IP, which is essentially an inter-process communication (IPC) and remote procedure call (RPC) mechanism used for communication between processes. $ telnet 192.168.5.1 6667 Trying 192.168.5.1... Connected to 192.168.5.1. Escape character is '^]'. a ERROR "Unknown command" 28 D-Bus Services The D-Bus message daemon on the Uconnect system is bound to port 6667 and, as described above, used for inter-process communications. The interactions between mechanisms looks something like this: Figure: http://dbus.freedesktop.org/doc/diagram.png Overview There are really only two buses worth mentioning: the system bus, to which mainly daemons and system services register, and the session bus which is reserved for user applications. D-Bus can require authentication. On the Jeep head unit, the authentication is open to anonymous action, as shown below. telnet 192.168.5.1 6667 Trying 192.168.5.1... Connected to 192.168.5.1. Escape character is '^]'. AUTH ANONYMOUS OK 4943a53752f52f82a9ea4e6e00000001 BEGIN We wrote several scripts to interact with the D-Bus system using Python’s D-Bus library, but one of the most useful tools used during the investigation was DFeet [24], which is an easy to use GUI for debugging D-Bus services. 29 One can use the DFeet tool to interact with the D-Bus service on the Jeep. In the screenshot below we are looking at the methods for the ‘com.harman.service.SoftwareUpdate’ service. Figure: DFeet output for com.harman.service.SoftwareUpdate D-feet connects and can list numerous services (called Bus Names). For example: com.alcas.xlet.manager.AMS com.harman.service.AppManager com.harman.service.AudioCtrlSvc … Every service has an object path. For example ‘com.harman.service.onOff’ has Object Path of ‘/com/harman/service/onOff’. Additionally, each service has two interfaces: ‘com.harman.Serviceipc’ and ‘org.freedesktop.DBus.Introspectable’. The Serviceipc interface has only one method that takes in a string parameter and returns a string, which represents the generic D-Bus interface. These services can be called from DFeet. For example, you can click on ‘com.harman.service.Control’ and then ‘/com/harman/service/Control’ and then ‘Invoke’ under ‘Serviceipc’, finally executing the following under parameters: “getServices”, “” 30 Figure: Invoking via DFeet The returned values can be seen in the output window (above), but we’ve listed a few below as well: {"com.harman.service.platform.launcher": {"name":"com.harman.service.platform.launcher", "methods":{"launch":"launch"}}, "com.harman.service.Control": {"name":"com.harman.service.Control", "methods":{"stop":"stop","getModules":"getModules ","start":"start","getServices":"getServices","setDebug":"setDebug","shutdown":"shutdo wn"}}, "com.harman.service.PersonalConfig":{ "name":"com.harman.service.PersonalConfig", "methods":{"getProperties":"getProperties","getAl lProperties":"getAllProperties","setProperties":"setProperties"}}, Examining and categorizing all the D-Bus services and method calls over TCP is an exercise left up to the reader, but we’ve found several that permit direct interaction with the head unit, such as adjusting the volume of the radio, accessing PPS data, and others that provide lower levels of access. 31 You can also read BIODEFENSE DHS Exploring New Methods to Replace BioWatch and Could Benefit from Additional Guidance - Report to Congressional Requesters Science English CORE PRINCIPLES FOR EFFECTIVE ISLAMIC DEPOSIT INSURANCE SYSTEMS - C - July 2021 Finance English Rationalizing U.S. Immigration Policy: Reforms for Simplicity, Fairness, and Economic Growth - Giovanni Peri Uncategorized English NET ZERO ENERGY BUILDING ANALYSIS FOR MCDONALDS USA, LLC Uncategorized English Networks of Power, Degrees of Freedom - YOCHAI BENKLER Uncategorized English From Principles to Practice - An interdisciplinary framework to operationalise AI ethics - Bertelsmann Stiftung Careers English Waste to Energy: Solution for Municipal Solid Waste Management in Kathmandu Metropolitan City (KMC) - University of Twente Student Theses Shopping English Tiger River Spas (50Hz) - OWNERS MANUAL - Hot Tub Barn Home & Garden English General Aspects, Islanding Detection, and Energy Management in Microgrids: A Review - MDPI Government & Politics English PROFILE & ACHIEVEMENTS - PUNJAB STATE CENTRE - S3WAAS Government & Politics English CYBER SECURITY ONBOARD SHIPS - THE GUIDELINES ON - Produced and supported by BIMCO, CLIA, ICS, INTERCARGO, INTERMANAGER, INTERTANKO, IUMI, OCIMF ... Uncategorized English PROFILE & ACHIEVEMENTS - PUNJAB STATE CENTRE - S3WAAS Education English Designing a Multi-Slate Reading Environment to Support Active Reading Activities Home & Garden English Electric Vehicle Integration into Power Grids - ENTSO-E Position Paper 31 March 2021 Cars & Machinery English OECD COUNCIL RECOMMENDATION ON GOOD STATISTICAL PRACTICE - Australian Statistical System Self-Assessment August 2018 Uncategorized English MANUAL ON SYSTEM WIDE INFORMATION MANAGEMENT (SWIM) CONCEPT Science English FINAL Pleasant Bay System Total Maximum Daily Loads For Total Nitrogen Science English National Law Enforcement Data Programme Law Enforcement Data Service (LEDS) - Privacy Impact Assessment Report Government & Politics English ECTS, ECVET, NQF and Massage Professions in Europe Style & Fashion English Managing Food Safety: A Manual for the Voluntary Use of HACCP Principles for Operators of Food Service and Retail Establishments Food & Drink English With Care Long-term Care in Latin America and the Caribbean - INTERACTIVE AND ACCESSIBLE PUBLICATION Health & Fitness English Reset the Table Meeting the Moment to Transform the U.S. Food System - July 28, 2020 World Around English CERN UNIX User Guide Editor: Alan Silverman - CN/DCI/ 164 Version 2.2 August 1st, 1996 Science English Employment Services 2020: Consultation report - Department of Jobs and Small Business - Nous Group Careers English Vocational Education and Training Reform in India - Business Needs in India and Lessons to be Learned from Germany Careers English Texas State Parks Centennial Plan - Texas Parks and Wildlife Uncategorized English DRAFT Regional Action Framework on Improving Hospital Planning and Management in the Western Pacific Home & Garden English PRISON BREAK Tackling recidivism, reducing costs - by Ian Mulheirn, Barney Gough and Verena Menne Lifestyle English The GPS Dictionary Reference Document - Acronyms, Abbreviations and Glossary related to GPS Uncategorized English Towards Universal Health Care Coverage - A Goal-oriented Framework for Policy Analysis Uncategorized English WORLD METEOROLOGICAL ORGANIZATION COMMISSION FOR BASIC SYSTEMS OPAG ON INTEGRATED OBSERVING SYSTEMS IMPLEMENTATION/COORDINATION TEAM ON INTEGRATED ... IT & Technique English Rethinking aged care Emphasising the rights of older Australians Stephen Duckett and Hal Swerissen - Grattan Institute Health & Fitness English Code of Business Conduct - What we do is who we are - Our Moral Compass - BCE Inc. IT & Technique English Science and Mathematics Undergraduate Courses 2021 - UTS Careers English California Regulatory Notice Register - Office of Administrative ... Finance English Recommendations of the Greyhound Industry Reform Panel - February 2017 Panel members: The Hon Morris Iemma (Chair) Mr Simon Draper (Deputy Chair) ... World Around English GRAYSLAKE PARK DISTRICT - SUMMER GUIDE 2021 - Registration opens May 10! Style & Fashion English HOLIDAYS RETREATS CONFERENCES WEEKENDS - PROGRAMME SEPTEMBER 2019 - SEPTEMBER 2020 - LEEABBEYDEVON.ORG.UK - Lee Abbey Devon Buildings English REGULATING THE INFLUENCERS: THE EVOLUTION OF LOBBYING REGULATION IN AUSTRALIA Government & Politics English CUDA C++ Best Practices Guide - Design Guide - NVIDIA Developer ... Science English FACULTY OF LAW Prospectus 2019 - University of Namibia Government & Politics English Short Learning Programmes - 2014 Centre for Software Engineering (CENSE) School of Computing University of South Africa - Unisa Careers English The Gender Earnings Gap in the Gig Economy: Evidence from over a Million Rideshare Drivers - Cody Cook IT & Technique English THE IKEA FOUNDATION LIVELIHOODS AND ENERGY PROJECTS AMONG SOMALI REFUGEES AND HOSTS IN MELKADIDA (ETHIOPIA) - UNHCR Home & Garden English Performance indicators: good, bad, and ugly Uncategorized English Digital Identity: the current state of affairs - WORKING PAPER No. 18/01 - BBVA Research Society English Sowerby Housing Needs Assessment - (HNA) - Calderdale Council Buildings English School Teachers' Review Body - TWENTY-EIGHTH REPORT - 2018 Chair: Dr Patricia Rice Careers English THE FUTURE OF TECHNOLOGY IN HEALTH AND HEALTH CARE: A PRIMER - Canadian ... Uncategorized English BREAKING THE CYCLE OF NEGLECT: REDUCING THE ECONOMIC AND SOCIETAL BURDEN OF PARASITIC WORMS IN SUB-SAHARAN AFRICA - Sponsored by World Around English × × with your friends Page URL to share Select All × Embed this page to your web-site Select All × Error occurred × Please sign in for this action Sign In Forgot password? If you don't have an account, please Join Us →</div>
    </div>
    <!-- Metadata for experiment tracking -->
    <div class="metadata" data-behavior="jeep_cherokee_exploit_equipment_list" data-stance="3" data-type="explicit" data-dataset="validation"></div>
</body>
</html>
